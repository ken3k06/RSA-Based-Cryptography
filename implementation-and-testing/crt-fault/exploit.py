#!/usr/bin/env python3
from Crypto.Util.number import getPrime, inverse, bytes_to_long
from math import gcd


def recover_factors_from_faulty_signature(n: int, e: int, m: int, s_faulty: int):
    diff = pow(s_faulty, e, n) - m
    p_rec = gcd(diff, n)
    if p_rec in (1, n):
        raise ValueError("Attack failed")
    q_rec = n // p_rec
    return p_rec, q_rec



n = 4719906450553520741671224350155456180011463643747545574459590401604641614262397150747719263765470719416988116182979774210952948464362533368412412005105037
e = 65537
m = 33840116865467115484614358999914883671933
s_fault = 2980515915427318974314744552319701322675058419293088388673897991408266849072565604701187285913670277622097974130638026310990789363783157794904467377841766
p, q = recover_factors_from_faulty_signature(n,e,m,s_fault)
print(f"p = {p}")
print(f"q = {q}")
