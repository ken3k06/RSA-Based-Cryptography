from Cryptodome.Util.number import *
from sage.all import *
from itertools import combinations
from sympy.ntheory.modular import crt
from gmpy2 import iroot
from pathlib import Path



def extract_nc_pairs(file_path):
    nc_pairs = []
    with open(file_path, 'r') as file:
        lines = file.readlines()

    n = c = None
    for line in lines:
        line = line.strip()
        if line.startswith("n ="):
            n = int(line.split("=", 1)[1].strip())
        elif line.startswith("c ="):
            c = int(line.split("=", 1)[1].strip())
        if n is not None and c is not None:
            nc_pairs.append((n, c))
            n = c = None

    return nc_pairs

def find_m_with_nc(nc_pairs):
    for combo in combinations(nc_pairs, 3):
        moduli = [n for n, c in combo]
        remainders = [c for n, c in combo]
        result = crt(moduli, remainders)
        if result is not None:
            m = result[0]  
            root, is_exact = iroot(m, 3)
            if is_exact:
                decode_message=long_to_bytes(int(root))
                print(f"m = {m}, cube root = {int(root)}")
                print(f"Flag l√†: {decode_message}")
current_dir = Path.cwd() 
file_path = current_dir / "output1.txt"
nc_pairs = extract_nc_pairs(file_path)
find_m_with_nc(nc_pairs)
