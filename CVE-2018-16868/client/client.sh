#!/bin/bash
set -e

TARGET_HOST=${TARGET_HOST:-server}
TARGET_PORT=${TARGET_PORT:-4443}
LOOPS=${LOOPS:-1000}

echo "[*] GnuTLS version:"
gnutls-cli --version

echo "[*] Target: $TARGET_HOST:$TARGET_PORT"
echo "[*] Loops: $LOOPS"

for i in $(seq 1 $LOOPS); do
  echo "[*] Iteration $i"
  echo | gnutls-cli \
    -p $TARGET_PORT \
    $TARGET_HOST \
    --priority "NORMAL:-KX-ALL:+RSA:-VERS-ALL:+VERS-TLS1.2" \
    --insecure \
    >/dev/null 2>&1
done

echo "[+] Done"
